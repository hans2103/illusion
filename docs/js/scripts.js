!function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.gumshoe=t(e)}("undefined"!=typeof global?global:this.window||this.global,function(c){"use strict";var i,t,s,n,o,a,r={},l=[],u={selector:"[data-gumshoe] a",selectorHeader:"[data-gumshoe-header]",container:c,offset:0,activeClass:"active",scrollDelay:!1,callback:function(){}},d=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e);else for(var a=0,r=e.length;a<r;a++)t.call(n,e[a],a,e)},f=function(){var n={},o=!1,e=0,t=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(o=arguments[0],e++);for(var a=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o&&"[object Object]"===Object.prototype.toString.call(e[t])?n[t]=f(!0,n[t],e[t]):n[t]=e[t])};e<t;e++){a(arguments[e])}return n},v=function(e){var t=0;if(e.offsetParent)for(;t+=e.offsetTop,e=e.offsetParent;);else t=e.offsetTop;return 0<=(t=t-o-i.offset)?t:0};r.setDistances=function(){var e;s=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),o=n?(e=n,Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)+v(n)):0,d(l,function(e){e.distance=v(e.target)}),l.sort(function(e,t){return e.distance>t.distance?-1:e.distance<t.distance?1:0})};var m=function(){a&&(a.nav.classList.remove(i.activeClass),a.parent&&a.parent.classList.remove(i.activeClass))},g=function(e){m(),e.nav.classList.add(i.activeClass),e.parent&&e.parent.classList.add(i.activeClass),i.callback(e),a={nav:e.nav,parent:e.parent}};r.getCurrentNav=function(){var e,t,n=c.pageYOffset;if(c.innerHeight+n>=s&&(e=l[0].target,0<=(t=e.getBoundingClientRect()).top&&0<=t.left&&t.bottom<=(c.innerHeight||document.documentElement.clientHeight)&&t.right<=(c.innerWidth||document.documentElement.clientWidth)))return g(l[0]),l[0];for(var o=0,a=l.length;o<a;o++){var r=l[o];if(r.distance<=n)return g(r),r}m(),i.callback()};r.destroy=function(){i&&(i.container.removeEventListener("resize",h,!1),i.container.removeEventListener("scroll",h,!1),l=[],a=o=n=s=t=i=null)};var p=function(e){window.clearTimeout(t),t=setTimeout(function(){r.setDistances(),r.getCurrentNav()},66)},h=function(e){t||(t=setTimeout(function(){t=null,"scroll"===e.type&&r.getCurrentNav(),"resize"===e.type&&(r.setDistances(),r.getCurrentNav())},66))};return r.init=function(e){var t;"querySelector"in document&&"addEventListener"in c&&"classList"in document.createElement("_")&&(r.destroy(),i=f(u,e||{}),n=document.querySelector(i.selectorHeader),t=document.querySelectorAll(i.selector),d(t,function(e){if(e.hash){var t=document.querySelector(e.hash);t&&l.push({nav:e,target:t,parent:"li"===e.parentNode.tagName.toLowerCase()?e.parentNode:null,distance:0})}}),0!==l.length&&(d(l,function(e){e.nav.classList.contains(i.activeClass)&&(a={nav:e.nav,parent:e.parent})}),r.setDistances(),r.getCurrentNav(),i.container.addEventListener("resize",h,!1),i.scrollDelay?i.container.addEventListener("scroll",p,!1):i.container.addEventListener("scroll",h,!1)))},r});