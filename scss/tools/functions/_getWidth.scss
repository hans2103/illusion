// Globals
@use "sass:math";
@use "sass:map";
@use "sass:list";

// Variables
@use "../variables/breakpoints";
@use "../variables/grid";
@use "../variables/span";

// Tools
@use "../tools";

// Functions
@use "getContainer";
@use "largestWidth";
@use "lastValue";
@use "mapGet";
@use "mapGetNext";
@use "smallestGutter";


// Returns gallery/span width

@function getWidth($span: span.$illusion-span-span, $multiplier: span.$illusion-span-multiplier, $gutter: span.$illusion-span-gutter) {

  // Give a warning when $multiplier is not dividable by 0.5
  @if ($multiplier % 0.5 != 0 and tools.$illusion-display-warnings != false) {
    @warn 'The `multiplier` in the `getWidth` function is designed to work best with a number dividable by 0.5';
  }

  // Set default column width
  $columnWidth: false;
  $columnGutter: false;

  // Set default gutter to smallest one
  $breakpointGutter: smallestGutter.smallestGutter() * $multiplier;

  // Span values
  $spanColumns: list.nth($span, 1);
  $spanContainer: getContainer.getcontainer($span);
  $spanAmount: math.div($spanContainer, $spanColumns);

  // Run through each breakpoint and create a new map
  @if breakpoints.$inside-breakpoint != false and $gutter == false {
    @each $breakpoint, $values in grid.$illusion-grid-breakpoints {

      // Values
      $mapWidth: map.get($values, width);
      $mapGutter: map.get($values, gutter) * $multiplier;
      $nextKey: mapGetNext.map-get-next(grid.$illusion-grid-breakpoints, $breakpoint, #{lastValue.lastValue()});
      $nextWidth: mapGet.map-deep-get(grid.$illusion-grid-breakpoints, $nextKey, "width");
      $largestWidth: largestWidth.largestWidth();

      // Create new temporary map and merge it with the current one
      @if (breakpoints.$inside-breakpoint >= $mapWidth and breakpoints.$inside-breakpoint < $nextWidth) or (breakpoints.$inside-breakpoint >= $largestWidth) {
        $columnGutter: ($spanAmount - 1) * $mapGutter * $multiplier;
      }
    }
  } @else if $gutter != false {
    $columnGutter: ($spanAmount - 1) * $gutter * $multiplier;
  }
  @else {
    $columnGutter: ($spanAmount - 1) * $breakpointGutter * $multiplier;
  }
  // Calculate column width
  $columnWidth: calc((100% - #{$columnGutter}) / #{$spanAmount});

  @return $columnWidth;
}
